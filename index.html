<!DOCTYPE html>
<html>
    <head>
        <title>xpath1's super game emulator</title>
    </head>
    <body>
        <input type="password" id="password">
        <button id="attempt">Attempt password</button>
        <script>
            function set_cookie(name, value) {
                document.cookie = name + "=" + (value || "") + "; path=/";
            }

            function get_cookie(name) {
                var true_name = name + "=";
                var split_cookie = document.cookie.split(';');
                for (var i = 0; i < split_cookie.length; i++) {
                    var split = split_cookie[i];
                    while (split.charAt(0) == ' ') {
                        split = split.substring(1, split.length);
                    }
                    if (split.indexOf(true_name) == 0) {
                        return split.substring(true_name.length, split.length)
                    }
                }
                return null;
            }
            
            const fingerprint_js_promise = import('https://openfpcdn.io/fingerprintjs/v4')
                .then(FingerprintJS => FingerprintJS.load());
            
            var get_raw_html = new XMLHttpRequest();
            get_raw_html.open("GET", "raw.html", true);
            get_raw_html.onreadystatechange = function() {
                if (this.readyState !== 4) {
                    return
                };
                if (this.status !== 200) {
                    return
                }

                document.getElementById("y").innerHTML= this.responseText;
            };
            get_raw_html.send();

            var raw_page = get_raw_html.responseText;
            
            fingerprint_js_promise
                .then(fingerprint => fingerprint.get())
                .then(result => {
                    const visitor_id = result.visitorId;
                    if (visitor_id == get_cookie("attempt_password")) {
                        document.write(raw_page);
                    }
            });

            document.getElementById("attempt").onclick = function() {
                fingerprint_js_promise
                    .then(fingerprint => fingerprint.get())
                    .then(result => {
                        const visitor_id = result.visitorId;
                        const password = document.getElementById("password").value;
                        set_cookie("attempt_password", password);
                        if (password == "enabIe_the_very_cool_debugging_feature") {
                            console.log(visitor_id);
                        } else if (password == visitor_id) {
                            document.write(raw_page);
                        }
                });
            };
        </script>
    </body>
</html>
